<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>原神コード変換</title>
    <style>
        body {
            font-family: sans-serif;
        }

        textarea {
            width: 95%;
            height: 200px;
            margin-bottom: 10px;
            padding: 10px;
            font-size: 16px;
        }

        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        #markdown-output {
            width: 95%;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            white-space: pre-wrap;
            font-size: 16px;
        }

        #error-message {
            color: red;
            margin-top: 10px;
        }

        #copy-button {
            margin-left: 10px;
        }
    </style>
</head>

<body>

    <h1>原神コード変換</h1>

    <textarea id="json-input" placeholder="ここにJSONデータを貼り付けてください"></textarea>
    <button id="convert-button">変換</button>

    <div id="error-message"></div>

    <pre id="markdown-output"></pre>
    <button id="copy-button">コピー</button>


    <script>
        const convertButton = document.getElementById('convert-button');
        const jsonInput = document.getElementById('json-input');
        const markdownOutput = document.getElementById('markdown-output');
        const errorMessage = document.getElementById('error-message');
        const copyButton = document.getElementById('copy-button');

        convertButton.addEventListener('click', () => {
            errorMessage.textContent = ''; // エラーメッセージをクリア
            try {
                const jsonData = JSON.parse(jsonInput.value);
                // addedDateで降順にソート
                jsonData.sort((a, b) => {
                    const dateA = new Date(a.addedDate.replace('追加日：', ''));
                    const dateB = new Date(b.addedDate.replace('追加日：', ''));
                    return dateB - dateA; // 降順
                });

                // 最終更新日を取得 (一番上のデータのaddedDate)
                const lastUpdatedDate = jsonData[0].addedDate;

                const markdownContent = `# 原神コード配布 (最終更新日: ${lastUpdatedDate})\n\n**コードの期限は分からないので各々で確認してください(一応最新のコードから順に並べてあります)**\n\n \n\n${jsonData.map(code =>
                    `## ${code.code} (${code.addedDate})\n\n` +
                    `**コード:** [${code.code}](https://genshin.hoyoverse.com/ja/gift?code=${code.code})\n\n` +
                    `**報酬内容:**\n${code.rewards.map(reward => `- ${reward}`).join('\n')}\n\n`
                ).join('')}`;

                markdownOutput.textContent = markdownContent;
            } catch (error) {
                errorMessage.textContent = 'JSONデータの形式が正しくありません。';
                console.error(error);
            }
        });

        copyButton.addEventListener('click', () => {
            const textToCopy = markdownOutput.textContent;
            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    alert('クリップボードにコピーしました！');
                })
                .catch(err => {
                    console.error('コピーに失敗しました: ', err);
                    alert('コピーに失敗しました。ブラウザの権限を確認してください。');
                });
        });
    </script>

</body>

</html>